<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextRide & Logistics - Invoice & Receipt Generator</title>
    <style>
        /* Professional styling for NextRide & Logistics */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            color: #212529;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 51, 153, 0.15);
            overflow: hidden;
            border: 1px solid rgba(0, 51, 153, 0.1);
        }

        /* Header with brand colors */
        .header {
            background: linear-gradient(135deg, #003399 0%, #0044cc 100%);
            color: white;
            padding: 30px 40px;
            border-bottom: 5px solid #ffc107;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .header .tagline {
            font-size: 1.2em;
            opacity: 0.95;
            font-style: italic;
        }

        .header .address {
            font-size: 0.9em;
            margin-top: 15px;
            opacity: 0.9;
            color: #f8f9fa;
        }

        /* Navigation/Mode Selection - ALL BUTTONS NOW VISIBLE BLUE */
        .mode-selector {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 30px 40px;
            background: white;
            border-bottom: 1px solid #dee2e6;
        }

        .mode-btn {
            flex: 1;
            padding: 20px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            color: white !important; /* Force white text */
            box-shadow: 0 8px 16px rgba(0, 51, 153, 0.2);
            border: 2px solid transparent;
        }

        .mode-btn i {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .mode-btn small {
            font-size: 0.7em;
            font-weight: normal;
            opacity: 0.95;
            margin-top: 5px;
        }

        /* ALL THREE BUTTONS HAVE BLUE BACKGROUNDS - VISIBLE AT ALL TIMES */
        #invoiceModeBtn {
            background: linear-gradient(135deg, #003399, #0044cc);
        }

        #receiptModeBtn {
            background: linear-gradient(135deg, #003399, #0044cc);
        }

        #settingsModeBtn {
            background: linear-gradient(135deg, #003399, #0044cc);
        }

        /* Active state - slightly darker with border */
        .mode-btn.active {
            background: linear-gradient(135deg, #002266, #003399) !important;
            border: 2px solid #ffc107;
            transform: scale(1.02);
            box-shadow: 0 12px 24px rgba(0, 51, 153, 0.3);
        }

        /* Hover effect - all buttons have same hover */
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 32px rgba(0, 51, 153, 0.25);
            background: linear-gradient(135deg, #0044cc, #0055dd) !important;
        }

        /* Form sections */
        .form-section {
            padding: 40px;
            display: none;
        }

        .form-section.active {
            display: block;
        }

        /* Company Settings specific styling */
        #settingsSection {
            background: white;
        }

        /* Form styling */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #003399;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 0.95em;
            transition: all 0.3s;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #003399;
            box-shadow: 0 0 0 3px rgba(0, 51, 153, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Section headers */
        .section-title {
            color: #003399;
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ffc107;
        }

        .subsection-title {
            color: #212529;
            font-size: 1.2em;
            font-weight: 600;
            margin: 30px 0 20px;
            padding-left: 10px;
            border-left: 5px solid #003399;
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: flex-end;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: #003399;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 51, 153, 0.2);
        }

        .btn-primary:hover {
            background: #0044cc;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 51, 153, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* File upload styling */
        .file-upload {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #003399;
            background: #e7f1ff;
        }

        .file-upload i {
            font-size: 2.5em;
            color: #003399;
            margin-bottom: 10px;
        }

        .file-upload p {
            color: #6c757d;
            margin-top: 10px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .mode-selector {
                flex-direction: column;
                padding: 20px;
            }

            .mode-btn {
                padding: 15px 20px;
                font-size: 1.1em;
            }

            .form-section {
                padding: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Loading indicator */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #003399;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status messages */
        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        /* Company info display */
        .company-info-display {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 6px solid #ffc107;
        }

        .company-info-item {
            display: flex;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .company-info-item:last-child {
            border-bottom: none;
        }

        .company-info-label {
            font-weight: 700;
            width: 120px;
            color: #003399;
        }

        .company-info-value {
            flex: 1;
            color: #212529;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with company info -->
        <div class="header">
            <h1>NextRide & Logistics</h1>
            <div class="tagline">Safety. Luxury. Value for Your Money.</div>
            <div class="address" id="headerAddress">
                No 29 Amoda Alli Street, Millennium Estate, Gbagada, Lagos, Nigeria<br>
                Tel: 08023428564, 08128859763 | Email: nextflight77@gmail.com
            </div>
        </div>

        <!-- Mode Selector - ALL BUTTONS HIGHLIGHTED IN BLUE -->
        <div class="mode-selector">
            <button id="invoiceModeBtn" class="mode-btn active">
                <span style="font-size: 2em;">üìÑ</span>
                Generate Invoice
                <small>Create professional invoices with trip details</small>
            </button>
            <button id="receiptModeBtn" class="mode-btn">
                <span style="font-size: 2em;">üßæ</span>
                Generate Receipt
                <small>Issue payment receipts for clients</small>
            </button>
            <button id="settingsModeBtn" class="mode-btn">
                <span style="font-size: 2em;">‚öôÔ∏è</span>
                Company Settings
                <small>Update your business information</small>
            </button>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>

        <!-- INVOICE SECTION -->
        <div id="invoiceSection" class="form-section active">
            <h2 class="section-title">Generate Invoice</h2>
            <form id="invoiceForm" enctype="multipart/form-data">
                <div class="form-grid">
                    <!-- Client Information -->
                    <div>
                        <h3 class="subsection-title">Client Information</h3>
                        <div class="form-group">
                            <label>Client Name *</label>
                            <input type="text" name="client_name" required placeholder="Enter client's full name">
                        </div>
                        <div class="form-group">
                            <label>Client Address</label>
                            <input type="text" name="client_address" placeholder="Enter client's address">
                        </div>
                        <div class="form-group">
                            <label>Client Contact</label>
                            <input type="text" name="client_contact" placeholder="Phone number or email">
                        </div>
                    </div>

                    <!-- Trip Details -->
                    <div>
                        <h3 class="subsection-title">Trip Details</h3>
                        <div class="form-group">
                            <label>Trip Type</label>
                            <select name="trip_type">
                                <option value="One Way">One Way</option>
                                <option value="Round Trip">Round Trip</option>
                                <option value="Hourly Rental">Hourly Rental</option>
                                <option value="Daily Rental">Daily Rental</option>
                                <option value="Weekly Rental">Weekly Rental</option>
                                <option value="Monthly Rental">Monthly Rental</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Pickup Point</label>
                            <input type="text" name="pickup_point" placeholder="Where to pick up">
                        </div>
                        <div class="form-group">
                            <label>Drop-off Point</label>
                            <input type="text" name="dropoff_point" placeholder="Destination">
                        </div>
                        <div class="form-group">
                            <label>Trip Date</label>
                            <input type="date" name="trip_date" value="<?php echo date('Y-m-d'); ?>">
                        </div>
                        <div class="form-group" id="returnDateGroup">
                            <label>Return Date</label>
                            <input type="date" name="return_date">
                        </div>
                    </div>
                </div>

                <!-- Service Details -->
                <h3 class="subsection-title">Service Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Service Description *</label>
                        <textarea name="description" required placeholder="Describe the service...">Corporate Transportation Service</textarea>
                    </div>
                    <div class="form-group">
                        <label>Route (Optional)</label>
                        <input type="text" name="route" placeholder="e.g., Ikeja ‚Üí Landmark Centre, VI">
                    </div>
                    <div class="form-group">
                        <label>Service Scope (One per line)</label>
                        <textarea name="service_scope" placeholder="Enter service scope items, one per line:
- Three clean buses
- Professional drivers
- Fuel included">Three (3) clean, well-maintained, air-conditioned buses.
Uniformed, experienced professional drivers.
Fuel and all operational costs for the duration.
Punctual pickup and dedicated standby availability.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" name="quantity" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>Price (N) *</label>
                        <input type="number" name="price" required step="1000" min="0" placeholder="Enter price in Naira">
                    </div>
                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea name="notes" placeholder="Enter any additional notes, payment terms, etc.">Payment is due within 7 days. Thank you for choosing NextRide!</textarea>
                    </div>
                </div>

                <!-- Branding Upload -->
                <h3 class="subsection-title">Branding (Optional)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Logo</label>
                        <div class="file-upload" onclick="document.getElementById('logoInvoice').click()">
                            <div style="font-size: 2.5em; color: #003399;">üìé</div>
                            <p>Click to upload your company logo</p>
                            <input type="file" id="logoInvoice" name="logo" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Signature</label>
                        <div class="file-upload" onclick="document.getElementById('signatureInvoice').click()">
                            <div style="font-size: 2.5em; color: #003399;">‚úçÔ∏è</div>
                            <p>Click to upload signature image</p>
                            <input type="file" id="signatureInvoice" name="signature" accept="image/*" style="display: none;">
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="reset" class="btn btn-secondary">Clear Form</button>
                    <button type="submit" class="btn btn-primary">üìÑ Generate Invoice PDF</button>
                </div>
            </form>
        </div>

        <!-- RECEIPT SECTION -->
        <div id="receiptSection" class="form-section">
            <h2 class="section-title">Generate Receipt</h2>
            <form id="receiptForm" enctype="multipart/form-data">
                <div class="form-grid">
                    <!-- Client Information -->
                    <div>
                        <h3 class="subsection-title">Client Information</h3>
                        <div class="form-group">
                            <label>Client Name *</label>
                            <input type="text" name="client_name" required placeholder="Enter client's full name">
                        </div>
                        <div class="form-group">
                            <label>Client Address</label>
                            <input type="text" name="client_address" placeholder="Enter client's address">
                        </div>
                        <div class="form-group">
                            <label>Client Contact</label>
                            <input type="text" name="client_contact" placeholder="Phone number or email">
                        </div>
                    </div>

                    <!-- Receipt Details -->
                    <div>
                        <h3 class="subsection-title">Receipt Details</h3>
                        <div class="form-group">
                            <label>Payment Method</label>
                            <select name="payment_method">
                                <option value="Cash">Cash</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="POS">POS</option>
                                <option value="Cheque">Cheque</option>
                                <option value="USSD">USSD</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount Paid (N) *</label>
                            <input type="number" name="amount_paid" required step="100" min="0" placeholder="Enter amount paid in Naira">
                        </div>
                    </div>
                </div>

                <!-- Service Description -->
                <h3 class="subsection-title">Service Description</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Service Description *</label>
                        <textarea name="description" required placeholder="Describe the service...">Transportation Service</textarea>
                    </div>
                    <div class="form-group">
                        <label>Route (Optional)</label>
                        <input type="text" name="route" placeholder="e.g., Ikeja ‚Üí Landmark Centre, VI">
                    </div>
                    <div class="form-group">
                        <label>Service Scope (One per line)</label>
                        <textarea name="service_scope" placeholder="Enter service scope items, one per line">Bus rental service with professional driver.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea name="notes" placeholder="Enter any additional notes">Thank you for your payment!</textarea>
                    </div>
                </div>

                <!-- Branding Upload -->
                <h3 class="subsection-title">Branding (Optional)</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Logo</label>
                        <div class="file-upload" onclick="document.getElementById('logoReceipt').click()">
                            <div style="font-size: 2.5em; color: #003399;">üìé</div>
                            <p>Click to upload your company logo</p>
                            <input type="file" id="logoReceipt" name="logo" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Signature</label>
                        <div class="file-upload" onclick="document.getElementById('signatureReceipt').click()">
                            <div style="font-size: 2.5em; color: #003399;">‚úçÔ∏è</div>
                            <p>Click to upload signature image</p>
                            <input type="file" id="signatureReceipt" name="signature" accept="image/*" style="display: none;">
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="reset" class="btn btn-secondary">Clear Form</button>
                    <button type="submit" class="btn btn-primary">üßæ Generate Receipt PDF</button>
                </div>
            </form>
        </div>

        <!-- COMPANY SETTINGS SECTION -->
        <div id="settingsSection" class="form-section">
            <h2 class="section-title">Company Settings</h2>

            <!-- Current Company Info Display -->
            <div class="company-info-display">
                <h3 style="color: #003399; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5em;">üè¢</span> Current Company Information
                </h3>
                <div id="currentCompanyInfo">
                    <div class="company-info-item">
                        <span class="company-info-label">Company Name:</span>
                        <span class="company-info-value" id="displayCompanyName">NextRide & Logistics</span>
                    </div>
                    <div class="company-info-item">
                        <span class="company-info-label">Tagline:</span>
                        <span class="company-info-value" id="displayTagline">Safety. Luxury. Value for Your Money.</span>
                    </div>
                    <div class="company-info-item">
                        <span class="company-info-label">Address:</span>
                        <span class="company-info-value" id="displayAddress">No 29 Amoda Alli Street, Millennium Estate, Gbagada, Lagos, Nigeria</span>
                    </div>
                    <div class="company-info-item">
                        <span class="company-info-label">Phones:</span>
                        <span class="company-info-value" id="displayPhones">08023428564, 08128859763</span>
                    </div>
                    <div class="company-info-item">
                        <span class="company-info-label">Emails:</span>
                        <span class="company-info-value" id="displayEmails">nextflight77@gmail.com, janeagboola@yahoo.com</span>
                    </div>
                    <div class="company-info-item">
                        <span class="company-info-label">Bank Details:</span>
                        <span class="company-info-value" id="displayBankDetails">Bank: Sterling Bank | Account No: 0123186628 | Name: NextRide & Logistics</span>
                    </div>
                </div>
            </div>

            <h3 class="subsection-title">Update Company Information</h3>
            <form id="settingsForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="company_name" name="name" placeholder="Enter company name" value="NextRide & Logistics">
                    </div>
                    <div class="form-group">
                        <label>Tagline</label>
                        <input type="text" id="company_tagline" name="tagline" placeholder="Enter company tagline" value="Safety. Luxury. Value for Your Money.">
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea id="company_address" name="address" placeholder="Enter company address">No 29 Amoda Alli Street, Millennium Estate, Gbagada, Lagos, Nigeria</textarea>
                    </div>
                    <div class="form-group">
                        <label>Phone Numbers</label>
                        <input type="text" id="company_phones" name="phones" placeholder="Enter phone numbers" value="08023428564, 08128859763">
                    </div>
                    <div class="form-group">
                        <label>Email Addresses</label>
                        <input type="text" id="company_emails" name="emails" placeholder="Enter email addresses" value="nextflight77@gmail.com, janeagboola@yahoo.com">
                    </div>
                    <div class="form-group">
                        <label>Bank Details</label>
                        <input type="text" id="company_bank_details" name="bank_details" placeholder="Enter bank details" value="Bank: Sterling Bank | Account No: 0123186628 | Name: NextRide & Logistics">
                    </div>
                    <div class="form-group">
                        <label>Company Description</label>
                        <textarea id="company_description" name="description" placeholder="Enter company description">Our vehicles are well-maintained with fully functional AC for maximum comfort. We offer rentals‚Äîdaily, weekly, or monthly‚Äîbacked by professional and courteous drivers. Enjoy interstate travel with peace of mind, knowing you're in safe hands.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Footer Text</label>
                        <input type="text" id="company_footer" name="footer" placeholder="Enter footer text" value="Copyright ¬© 2025 | Invoice powered by Opygoal Technology Ltd. | Developer: Oladotun Ajakaiye, Service Manager & Data Analyst">
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="reset" class="btn btn-secondary">Reset</button>
                    <button type="submit" class="btn btn-primary">üíæ Save Company Settings</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div style="color: #003399; font-size: 1.2em; font-weight: 600;">Generating PDF, please wait...</div>
    </div>

    <script>
        // ============== MODE SELECTION - ALL BUTTONS VISIBLE BLUE ==============
        document.addEventListener('DOMContentLoaded', function() {
            // Get all mode buttons and sections
            const invoiceBtn = document.getElementById('invoiceModeBtn');
            const receiptBtn = document.getElementById('receiptModeBtn');
            const settingsBtn = document.getElementById('settingsModeBtn');
            const invoiceSection = document.getElementById('invoiceSection');
            const receiptSection = document.getElementById('receiptSection');
            const settingsSection = document.getElementById('settingsSection');

            // ALL BUTTONS ALREADY HAVE BLUE BACKGROUND FROM CSS
            // This just handles the active state highlighting

            // Function to switch between modes
            function setActiveMode(activeButton, activeSection) {
                // Remove active class from all buttons
                invoiceBtn.classList.remove('active');
                receiptBtn.classList.remove('active');
                settingsBtn.classList.remove('active');

                // Remove active class from all sections
                invoiceSection.classList.remove('active');
                receiptSection.classList.remove('active');
                settingsSection.classList.remove('active');

                // Add active class to selected button and section
                activeButton.classList.add('active');
                activeSection.classList.add('active');

                // Clear any status messages
                document.getElementById('statusMessage').className = 'status-message';
                document.getElementById('statusMessage').innerHTML = '';
            }

            // Add click event listeners to all mode buttons
            invoiceBtn.addEventListener('click', function() {
                setActiveMode(invoiceBtn, invoiceSection);
            });

            receiptBtn.addEventListener('click', function() {
                setActiveMode(receiptBtn, receiptSection);
            });

            settingsBtn.addEventListener('click', function() {
                setActiveMode(settingsBtn, settingsSection);
                // Load current company settings when switching to settings tab
                loadCompanySettings();
            });

            // ============== COMPANY SETTINGS FUNCTIONS ==============

            // Load company settings from backend
            window.loadCompanySettings = function() {
                fetch('/get_company_info')
                    .then(response => response.json())
                    .then(data => {
                        // Update form fields
                        document.getElementById('company_name').value = data.name || 'NextRide & Logistics';
                        document.getElementById('company_tagline').value = data.tagline || 'Safety. Luxury. Value for Your Money.';
                        document.getElementById('company_address').value = data.address || '';
                        document.getElementById('company_phones').value = data.phones || '';
                        document.getElementById('company_emails').value = data.emails || '';
                        document.getElementById('company_bank_details').value = data.bank_details || '';
                        document.getElementById('company_description').value = data.description || '';
                        document.getElementById('company_footer').value = data.footer || '';

                        // Update display section
                        updateCompanyInfoDisplay(data);
                    })
                    .catch(error => {
                        console.error('Error loading company settings:', error);
                        showStatus('Error loading company settings', 'error');
                    });
            };

            // Update company info display
            function updateCompanyInfoDisplay(data) {
                document.getElementById('displayCompanyName').textContent = data.name || 'NextRide & Logistics';
                document.getElementById('displayTagline').textContent = data.tagline || 'Safety. Luxury. Value for Your Money.';
                document.getElementById('displayAddress').textContent = data.address || '';
                document.getElementById('displayPhones').textContent = data.phones || '';
                document.getElementById('displayEmails').textContent = data.emails || '';
                document.getElementById('displayBankDetails').textContent = data.bank_details || '';

                // Update header address
                document.getElementById('headerAddress').innerHTML = `${data.address || 'No 29 Amoda Alli Street, Millennium Estate, Gbagada, Lagos, Nigeria'}<br>Tel: ${data.phones || '08023428564, 08128859763'} | Email: ${data.emails || 'nextflight77@gmail.com'}`;
            }

            // Save company settings
            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = {
                    name: document.getElementById('company_name').value,
                    tagline: document.getElementById('company_tagline').value,
                    address: document.getElementById('company_address').value,
                    phones: document.getElementById('company_phones').value,
                    emails: document.getElementById('company_emails').value,
                    bank_details: document.getElementById('company_bank_details').value,
                    description: document.getElementById('company_description').value,
                    footer: document.getElementById('company_footer').value
                };

                fetch('/update_company_info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showStatus('Company information updated successfully!', 'success');
                        updateCompanyInfoDisplay(formData);
                    } else {
                        showStatus('Error updating company information: ' + data.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showStatus('Error updating company information', 'error');
                });
            });

            // ============== INVOICE GENERATION ==============

            // Show/hide return date based on trip type
            const tripTypeSelect = document.querySelector('select[name="trip_type"]');
            const returnDateGroup = document.getElementById('returnDateGroup');

            if (tripTypeSelect) {
                tripTypeSelect.addEventListener('change', function() {
                    if (this.value === 'Round Trip') {
                        returnDateGroup.style.display = 'block';
                    } else {
                        returnDateGroup.style.display = 'none';
                    }
                });
            }

            // Invoice form submission
            document.getElementById('invoiceForm').addEventListener('submit', function(e) {
                e.preventDefault();

                // Show loading indicator
                document.getElementById('loading').classList.add('active');

                const formData = new FormData(this);

                fetch('/generate_invoice', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw new Error(err.error || 'Error generating invoice'); });
                    }
                    return response.blob();
                })
                .then(blob => {
                    // Create download link
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'invoice.pdf';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    a.remove();

                    // Hide loading indicator
                    document.getElementById('loading').classList.remove('active');

                    showStatus('Invoice generated successfully!', 'success');
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading').classList.remove('active');
                    showStatus(error.message || 'Error generating invoice. Please try again.', 'error');
                });
            });

            // ============== RECEIPT GENERATION ==============

            // Receipt form submission
            document.getElementById('receiptForm').addEventListener('submit', function(e) {
                e.preventDefault();

                // Show loading indicator
                document.getElementById('loading').classList.add('active');

                const formData = new FormData(this);

                fetch('/generate_receipt', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw new Error(err.error || 'Error generating receipt'); });
                    }
                    return response.blob();
                })
                .then(blob => {
                    // Create download link
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'receipt.pdf';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    a.remove();

                    // Hide loading indicator
                    document.getElementById('loading').classList.remove('active');

                    showStatus('Receipt generated successfully!', 'success');
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading').classList.remove('active');
                    showStatus(error.message || 'Error generating receipt. Please try again.', 'error');
                });
            });

            // ============== UTILITY FUNCTIONS ==============

            // Show status message
            function showStatus(message, type) {
                const statusEl = document.getElementById('statusMessage');
                statusEl.className = 'status-message ' + type;
                statusEl.innerHTML = message;

                // Auto hide after 5 seconds
                setTimeout(() => {
                    statusEl.className = 'status-message';
                    statusEl.innerHTML = '';
                }, 5000);
            }

            // File upload display names
            function setupFileUploads() {
                const fileInputs = document.querySelectorAll('input[type="file"]');
                fileInputs.forEach(input => {
                    input.addEventListener('change', function() {
                        const parent = this.closest('.file-upload');
                        const p = parent.querySelector('p');
                        if (this.files.length > 0) {
                            p.innerHTML = `Selected: ${this.files[0].name}`;
                        } else {
                            p.innerHTML = 'Click to upload your file';
                        }
                    });
                });
            }

            setupFileUploads();

            // Initialize - load company settings
            loadCompanySettings();

            // Set default trip date to today
            const tripDateInput = document.querySelector('input[name="trip_date"]');
            if (tripDateInput) {
                const today = new Date().toISOString().split('T')[0];
                tripDateInput.value = today;
            }

            // Initially hide return date if not round trip
            if (tripTypeSelect && tripTypeSelect.value !== 'Round Trip') {
                returnDateGroup.style.display = 'none';
            }
        });
    </script>
</body>
</html>